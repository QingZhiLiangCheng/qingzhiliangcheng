---
{"created":"2025-09-24T19:34","updated":"2025-09-24T21:20","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/1.6 分组延时, 丢失和吞吐量/","dgPassFrontmatter":true,"noteIcon":""}
---

之前我们学过了数据交换的方式，有链路交换和分组交换，当然我们前面讲了链路交换不太适合计算机之间的通信，我们一般是采用的分组交换，当然，分组交换为了按需使用也付出了一定的代价，其中一些代价就是会发生延时和丢失
this lecture就是讲分组时延，丢失，吞吐量这些指标
### 分组丢失和延时是怎么怎么发生的？
![Pasted image 20250924194305.png|500](/img/user/accessory/Pasted%20image%2020250924194305.png)
路由器的每个链路都会有一个队列，当一个分组到达的时候，路由器会查询对应的路由表，找到要分到的链路，并将分组扔进这个链路的队列
如果队列中已经有分组了，那就要排队，这就是一个延时，这个叫排队延时
如果队列中已经满了，溢出了，那么这个分组就会被丢弃掉，这就是分组的丢失
这里有一个问题是为什么要排队？ -- 因为链路的传输能力小于到来的分组
那为什么不把队列弄大一些，这样就不会丢失了？ -- 这样排队延时会很大，响应时间太长了

### 四大延时
![Pasted image 20250924194817.png|500](/img/user/accessory/Pasted%20image%2020250924194817.png)
**处理延时**
当一个分组到达的时候，需要检查这个分组是否出错了，需要将这个分组的ip提取出来查路由表，还要对一些字段做一些处理(后面会讲)，这些操作都需要时间，这被称为处理延时
**排队延时**
查完路由表决定从某条链路放出去，如果队列中有其他的分组，那就要经理排队延时
**传输延时(发送延时)**
分组通过链路放出去，是一个bit一个bit往外打的
传输一个字节的时间？ 如果带宽为R(bps)，那么传输一个bit的时间就是$\frac{1}{R}$,如果数据的长度是L个bit，那么传输的时间就是$\frac{L}{R}$
从第一个bit打出去开始，到所有bit打完，叫传输延时
**传播延时**
bit在链路上所经过的时间叫做传播延时，d为距离，s为速率，传播延时为$\frac{d}{s}$
![Pasted image 20250917203623.png|300](/img/user/accessory/Pasted%20image%2020250917203623.png)

**排队延时取决于流量强度**
$I=\frac{La}{R}$ , 其中R是带宽，L是分组的长度，a是单位时间系统通过链路的分组个数，La就是单位时间通过链路放出去的比特的数量，La和R是一个量纲
研究表明，流量强度越接近于1，排队延时越接近于无穷大

### Internet的延时和路由？
可以通过tranceroute(Linux)诊断程序，来看一下延时
![Pasted image 20250924204623.png|500](/img/user/accessory/Pasted%20image%2020250924204623.png)
tranceroute的原理是发送3个分组
第一跳的往返延时，第二跳的往返延时...
他利用了一个协议叫做ICMP协议(互联网控制报文协议)
![Pasted image 20250924205736.png|500](/img/user/accessory/Pasted%20image%2020250924205736.png)
A向B传输的分组中，有一个头部，其中有一个字段叫做TTL(生存时间)，在A放出这个分组的时候TTL是个有效值，然后每经过一跳TTL就会减1，当TTL减为0的时候，这个路由器会给A发送一个消息说由于它的TTL为0了，所以扔掉了，并告知ip地址(我干的hhh)，所以就形成了上面我们看到的IP地址和延时的测量
那怎么知道走到头了呢？ 是TTL会设置一个很大值，到达目标B的时候，会解析这个分组，它其中所包含的目标的端口号，实际上B中并没有应用进程守候在这个端口，所以B会给A回一个目标端口不可达

### 分组丢失了怎么办？
实际上分组丢失了有三种情况
- 如果这条链路本身就是可靠的，是由上个节点重传
- 如果这条链路是不可靠的
	- 可能是由源主机重传
	- 如果是UDP，那丢了就是丢了，不重传
### 吞吐量
吞吐量指的是单位时间内，从原主机向目标主机发出去的有效的比特的数量
吞吐量有两种，一种是瞬间的，一种是平均的
- 瞬间吞吐量:在一个时间点的速率
- 平均吞吐量:在一个长时间内平均

短板效应
![Pasted image 20250924211148.png|500](/img/user/accessory/Pasted%20image%2020250924211148.png)


带宽vs.吞吐量？
可以认为带宽是理论值，吞吐量是实际值

实际中的吞吐量
实际上一条链路并不只有两个主机使用的，可能由十个主机对的通信在使用这段电路，那实际上其中两个主机只能用带宽的十分之一
可能传输的时候要占用全部带宽，但是平均下来要排队，所以只会用十分之一
所以实际上的瓶颈电路取决于这$\frac{1}{n'}$,所有链路上平均下来最小的那个带宽
