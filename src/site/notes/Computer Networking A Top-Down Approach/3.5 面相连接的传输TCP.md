---
{"created":"2025-12-01T20:26","updated":"2025-12-30T16:24","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/3.5 面相连接的传输TCP/","dgPassFrontmatter":true,"noteIcon":""}
---

### Overview
TCP向应用基础提供的是点对点的服务，即一个应用进程到另外一个应用应用进程点到点的双向的数据通信
TCP提供的是字节流的服务：发送方的应用进程交给下面的TCP什么样的字节流，接收方的TCP就交给应用进程什么样的字节流，不出错，不重复，不丢失，不失序，原原本本。但不提供报文的界限，这意味着发送方交给TCP的可能是两个报文，但是不能保证接收方的应用进程收到的就是两个应用进程，可能是一个大的报文，也可能是四个小的报文
TCP提供的是管道化和流水线的协议，可以在对方未经确认的情况下，向对方发送连续的很多TCP的段，应用程序交下来的报文，会按照MSS(Maximum Segment Size, 最大报文段长度)进行分割，并加上头部，变成很多TCP的报文段。 但TCP会给这些连续发送的TCP报文段提供拥塞控制，流量控制
![Pasted image 20251229212411.png|400](/img/user/accessory/Pasted%20image%2020251229212411.png)

![Pasted image 20251230151215.png|600](/img/user/accessory/Pasted%20image%2020251230151215.png)
发送方具有发送缓冲区，用于发送之后的检错重发，超时重传
接收方具有接受缓冲区，因为接收方读取的速率与发送方发送的速率是不一样的
全双工：同一连接中数据流可以同时双向
面相连接

### TCP段结构
![Pasted image 20251229212543.png|450](/img/user/accessory/Pasted%20image%2020251229212543.png)
16比特源端口号，16比特目的端口号
32比特序号，32比特确认号
序号是字节流的序号，即这个TCP报文端的body部分的第一个字节在整个报文中的偏移量
offest = begin + n * MSS
![Pasted image 20251230184128.png|600](/img/user/accessory/Pasted%20image%2020251230184128.png)

一般初始序号并不是从0开始的，这是因为方式一些老的在连接中的段对新连接造成影响
确认号：也是对字节计数，假设接收方给发送方一个555，意味着：接收方已经收到了554及554之前的所有的字节，这意味着接收方期望着发送发从555字节之后开始发送
![Pasted image 20251230184248.png](/img/user/accessory/Pasted%20image%2020251230184248.png)

首部长度：以4个字节为单位的首部长度
标志位：其中R, S, F是主要用于两个应用进程建立连接的标志位，有的标志位的组合表示第一次握手，有的标志位的组合表示第二次握手，有些标志位的组合代表连接建立的请求，有些标志位组合代表的是连接释放的请求
接收窗口用于流量控制，数值意味着愿意接受那么多字节的数据
checksum校验和: 和UDP中的checksum作用一致，校验是否出错，依然是UDP学过的，16bit求和，进位回滚，反码
除了20字节的固定长度，还有一些可选项，也是属于头部的一部分，具体到哪里开始时body部分，看首部长度
![Pasted image 20251230190306.png](/img/user/accessory/Pasted%20image%2020251230190306.png)

TCP序号和确认号的关系：
![Pasted image 20251230190612.png|300](/img/user/accessory/Pasted%20image%2020251230190612.png)
有一种应用叫做telnet，运用了回显的技术 -- 客户端发送的每一个服务器发送到了服务器，服务器要回转回来然后客户端再给出相应的确认
图中假设的初始建立连接的时候，第一条报文：Seq=42, ACK=79, data='C', HostA的报文段从42号开始传，ACK=79，意味着想让HostB从79开始传
HostB接收到之后，往回传ACK=43，意味着42我收到了，你该传43了，而且B知道了A表示78及之前都收到，HostB会传79
超时计时器的设置
![Pasted image 20251230192205.png|400](/img/user/accessory/Pasted%20image%2020251230192205.png)