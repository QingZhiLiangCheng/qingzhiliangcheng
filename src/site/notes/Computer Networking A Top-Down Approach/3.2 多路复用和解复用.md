---
{"created":"2025-12-01T20:25","updated":"2025-12-02T11:34","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/3.2 多路复用和解复用/","dgPassFrontmatter":true,"noteIcon":""}
---

在网络层是主机到主机从一个IP传到另一个IP，到了传输层，不管是TCP还是UDP，为了区分到不同进程到不同进程，增加了一个机制——端口号
但是TCP和UDP所使用端口的方式不太一样。在[[Computer Networking A Top-Down Approach/2.1 应用层协议原理#问题2：传输层提供的服务 -- 需要穿过层间的信息\|2.1 应用层协议原理#问题2：传输层提供的服务 -- 需要穿过层间的信息]]介绍过。
TCP具体的复用解复用过程是这样的：
首先源与目标已经各自本地建立好了TCP Socket，根据之前的学习，这是一个四元组(源IP，源Port端口，目标IP，目标端口)，而且在本地有一个类似文件描述符的句柄。
应用层往下交的是socket和Message。
我们在这里暂时忽略Message报文的拆分或者合并(实际上在[[Computer Networking A Top-Down Approach/2.1 应用层协议原理#问题2：传输层提供的服务 -- 需要穿过层间的信息\|2.1 应用层协议原理#问题2：传输层提供的服务 -- 需要穿过层间的信息]]也介绍过），在TCP层会在报文前面加上head(包含源Port，目标Port)封装成TCP报文段，TCP报文段与源IP，目标IP(代码层面可能是传的socket的引用，但概念层面其实就是源IP和目标IP) 一起传给下层的IP层
在IP层会将源IP与目标IP写入IP的头部封装成package
![Pasted image 20251202111214.png|400](/img/user/accessory/Pasted%20image%2020251202111214.png)
我们暂时先忽略是怎么传到目标IP主机的，但目标的IP层拿到之后，会取出其中的IP body(实际上就是TCP报文段)的部分，同时将拿到的body部分TCP报文段与源IP，目标IP 传给上层的TCP
上层的TCP拿到TCP报文段和IP信息后，会再TCP报文段中取出body部分(报文)，读取报文段头部的源Port和目标Port，TCP层将源Port和目标Port与下层传上来的源IP，目标IP重新拼成四元组，能够找到主机中对应的Socket以及PID，然后传给对应的应用
![Pasted image 20251202111229.png|400](/img/user/accessory/Pasted%20image%2020251202111229.png)

