---
{"created":"2025-12-01T20:25","updated":"2025-12-22T19:44","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/3.3 无连接传输UDP/","dgPassFrontmatter":true,"noteIcon":""}
---

UDP -- User Datagram Protocol 用户数据报协议
UDP在IP所提供的服务的基础上，只是增加了一个多路复用解复用，<font color="#f79646">还有简单的差错检测（2026.2.6补）</font>，换句话说，IP提供的是源IP到目标IP的服务，UDP具体到了端口到端口的服务，除此之外，UDP并没有在IP的基础上增加任何额外的东西
所以UDP所提供的服务像下层IP所提供的服务一样，也是尽力而为的，所以报文可能会丢，可能会乱序
UDP属于无连接的协议，没有握手，没有提前连接，因此不知道发给谁，这个信息是需要上层提供
一般用于流媒体的应用
UDP上的应用一般分为两种，一种是流媒体服务的应用，一种是事务形的应用，即一次往返就搞定的应用，比如DNS
那如果使用UDP，还想要增加可靠性，怎么办？ -- 在应用进程内部自己去实现可靠性
> [!note]
> 补充：UDP无连接状态，TCP需要再端系统重维护连接状态，包括接受和发送缓存，拥塞控制参数以及序号，确认号参数等
> 这里看原书之后补充了一些使用UDP的应用或者协议
> 域名解析系统DNS，网络管理SNMP(第五章会学)，流媒体应用，因特网电话，远程文件服务器NFS
> 还有一个比较特殊的，最近HTTP3的QUIC协议，QUIC协议将UDP作为其支撑运输协议，这里就迎合了上面所提到的“如果使用UDP，还想要增加可靠性，怎么办？ -- 在应用进程内部自己去实现可靠性”，QUIC协议需要在UDP之上的应用层协议实现可靠性！
> 补充：啥是SNMP？
> SNMP 是简单网络管理协议（Simple Network Management Protocol）的缩写，是 TCP/IP 协议族中专门用于网络设备统一监控与管理的应用层标准协议，让管理员能从一个控制台集中管控路由器、交换机、服务器、防火墙等多厂商设备
> 补充：啥是NFS？
> NFS 是网络文件系统（Network File System）的缩写，是一种基于 TCP/IP 协议的分布式文件共享协议，核心作用是让不同主机（通常是 Linux/Unix 类系统） 通过网络实现文件的共享访问，使得客户端可以像访问本地磁盘目录一样，访问远程 NFS 服务端的共享文件 / 目录，是 Linux 服务器集群、跨主机文件共享的核心技术之一

**UDP数据报的格式**
![Pasted image 20251222191253.png|300](/img/user/accessory/Pasted%20image%2020251222191253.png)
包括头部部分和数据部分，头部部分包括两个字节的源端口号，两个字节的目标端口号，两个字节的长度，两个字节的校验和
其中校验和就是EDC(差错检测码)，在原端做校验和的计算，在目标端判断校验和的范围和校验和本身是否还符合差错控制编码的关系 -- 校验和的作用就是判断UDP报文段在传输过程中，包括头部和载荷部分，在传输中是否出错；如果出错，这个UDP就会被扔掉
**为什么要UDP？**
- 不建立连接，没有连接的开销，相对来说简单
- 报文段头部的开销小，只有8个字节，而TCP的头部是20个字节，这样UDP的载荷占比更大
- 无流量控制，无拥塞控制 -> 应用进程往下交的速度有多快，UDP往IP交的速度就有多快，主机吐出的数据的速度就有多块（其中忽略了UDP，IP等增加头部的时间），这种特性对某些应用（比如多媒体的应用，比如摄像头边采集边发）是非常有用的

**UDP校验和**
EDC(Error Detection Code, 差错检测码)，是一大类用于发现错误冗余信息方法的统称，不是一种具体的算法，其核心的思想是发送方在数据中额外加入一些冗余比特，接收方用同样的规则检查判断数据是否有没有出错
注意校验通过，也不一定就是对的 -- 残存错误 -- 数据部分和EDC部分都出错了还对上了
具体到这里，UDP中，就是一种和的形式，做校验和
在UDP中，实际上的保护部分，不仅仅包括UDP的payload载荷部分，还包括一些头部，甚至包括一些伪头部，我们把整个保护部分暂且叫D
校验和具体来说，在发送方就是把D分成一个个16比特（不足的补0），把每个16比特段加起来和，然后算checksum(校验和) -- 注意这个时候实际上是把EDC置为0了
求和的细节有两个，一个叫进位回滚（更标准的叫法叫回卷），具体来说当加法产生溢出的进位时，把进位加到最低位；第二个细节是和的反码
![Pasted image 20251222193753.png|400](/img/user/accessory/Pasted%20image%2020251222193753.png)
接收方做的一个校验是：D和EDC都加起来，最后得出来的和是16位全1

> [!note]
> 值得注意的是，原书中说，计算检验和时，除了UDP报文段以外还包括了IP首部的一些字段，会有12字节的伪首部(4源IP，4目的IP，1字节保留位没啥用，1字节协议字段- UDP伪17 ，2字节UDP长度)；做检验和的实际上是 整个UDP报文(UDP首部+数据)+伪头部 分成16字节的段，给所有的段算和！记得要回卷 最后取反！
