---
{"created":"2025-11-29T20:45","updated":"2026-02-03T09:28","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/2.7 CDN/","dgPassFrontmatter":true,"noteIcon":""}
---

> [!quote]
> 原书2.6 Video Streaming and Content Distribution Networks
> // 2026.2.3 看原书补

### CDN Overview
杀手级的应用：网络流量站的比较多，用户多，比如视频业务
互联网中 视频业务 占据主流地位，如何向成千上万的用户并行提供播放服务？
挑战：
- 规模问题，如何并行的同时向用户提供视频服务业务
- 异构的客户端：每个节点的上下载带宽不一样，视频处理能力不一样

解决方案：分布式的，应用层面的基础设施 —— CDN

### 多媒体：视频的相关知识
![Pasted image 20251130161459.png|300](/img/user/accessory/Pasted%20image%2020251130161459.png)
视频可以看做是一帧一帧组成的，没一帧实际上是一个图像。这个图像实际上是色彩的一个有序编码
一般在传输过程中可能是需要压缩的，有空间上的压缩，时间上的压缩
所谓空间上的压缩就是在一个画面之中对有序编码的一个压缩，一方面这里的逻辑和我在数据库中学到的一些压缩的方法是一样的[[DataBase Systems/CMU 15-721 Advanced Database Systems/Lecture 02 lecture：Data Formats & Encoding I#Encoding Schemes\|Lecture 02 lecture：Data Formats & Encoding I#Encoding Schemes]]; 在[[math/Linear Algebra/Lecture 32 基变换和图像压缩\|Lecture 32 基变换和图像压缩]]中也介绍过图片压缩的相关线性代数上的一些知识。
空间上的压缩是指不同帧之间可能只需要传输动的那一部分...

### 流化服务
视频服务经常采用的服务叫流式服务(Streaming) -- 简单来说就是边看边下 -- 存在一个缓冲区
![Pasted image 20251130162342.png|400](/img/user/accessory/Pasted%20image%2020251130162342.png)
常见的一个多媒体流化服务的协议叫做DASH(Dynamic, Adaptive Streaming over HTTP, 在HTTP上动态自适应流化技术)。具体来说，就是将大的视频切成8~10s的一块一块的，在处理的时候，对每一块都处理成了不同解析度的（高解析度，中解析度，低解析度）形式放到一些服务器上（放到哪些，怎么放后面会讲）。换句话说，不同的块的视频上传到流媒体服务器实际上是变成了很多个不同版本的块。然后通过一个文件叫manifest file(告示文件)，描述了视频的一些信息，比如这个视频的描述信息，切成了多少块，每块持续的范围，有多少不同的版本，每个版本的不同块在那个url中... -- 实际上就是能够告诉我们流媒体服务器中每一个版本的码率，url等信息。这样在客户端下载的时候，实际上是先下载的mainfest file文件，然后解析这个文件，具体下载哪些块，是由客户端自己根据屏幕的尺寸，带宽，缓冲区的情况等各种因素决定的
DASH解决的是不同客户端，不同网络情况的需求的问题和能力的问题

> [!quote]
> 补充：The client selects different chunks one at a time with HTTP GET request messages.

### CDN
服务器如何通过网络向上百万用户同时流化视频内容？
Solution 1: 单个的，大的超级服务器中心
有很多缺点，比如服务器本身单点故障性能瓶颈；如果只有一个服务器就一定有的客户端到服务器上跳数较多，存在瓶颈链路的问题
Solution 2: CDN(Content Distribution Networks, 内容分发网络)
流媒体服务的运营商会买CDN的服务，CDN在全球的网络中部署了很多缓存节点server，然后一些内容就能够预先部署到缓存的server中。换句话说，其实增加了一种角色CDN运营商，ICP(Internet Content Provider， 互联网内容提供商，比如百度，CCTV，... )会买CDN运营商的服务
用户在访问的时候就不用去原服务器获得视频内容的优化服务。而是会通过域名解析的重定向定向到离他最近的cash server
CDN在全球部署两种类型的缓存节点，有两种主要类型的策略
第一种叫enter deep, 指的是缓存节点部署到很多local isp的内部；终端用户通过local isp接入到互联网，local isp接入到regional isp， regional在接入到group isp[[Computer Networking A Top-Down Approach/1.5 Internet结构和ISP\|1.5 Internet结构和ISP]]；当然好处就是跟用户在一个local isp中，跳数小，速度快；但是缺点是部署非常多的节点
第二种是bring home，将缓存节点部署到一些关键的位置，比如离两个数据中心都很近 比如IXP
其实CDN的这个核心就是 让内容靠近用户来做内容加速
内容加速的服务理论上应该是网络核心来做，但实际上在互联网中的架构，内容加速实在应用层去做的，在应用层中就一定是边缘系统以主机(cache节点) 的形式来提供的
不过除了节点的部署策略，内容部署也有一个部署策略的问题

补充：CDN工作的过程
CDN涉及到如何选取合适CDN服务器集群和如何重定向redirect的问题
如何重定向？一般都利用DNS来截获和重定向请求，具体过程如下
![Pasted image 20260203101511.png|400](/img/user/accessory/Pasted%20image%2020260203101511.png)
这其中NetCinema是提供流媒体的公司，而KindCDN是提供流媒体服务的公司
当我们访问NetCinema的官网www.NetCinema.com的时候，当我们点击视频连接，实际上我们会发送一个video.netcinema.com的DNS请求。我们的Local DNS server会去问NetCinema的权威服务器(quthoriative DNS server)请求video.netcinema.com的IP，但是权威服务器这时候会重定向，返回一个kingCDN的主机名：a1105.kingcdn.com。Local DNS在得到KingCND的主机名之后，会像kingCDN的权威服务器询问该主机的IP地址，然后像这个IP地址去建立TCP连接，发送HTTP请求获取内容

如何选取合适的CDN服务器？ -- 涉及到了集群选择策略(cluster selection strategy)
核心就是KingCDN在拿到localDNS的地址后，会做出一些决策
最简单的策略就是地理上邻近，是通过localDNS的ip地址与地理数据库相匹配。问题是可能地理上最近的集群可能并不是跳数最少的，可能用户配置使用远处的localDNS等等，同时这忽略了时延，带宽等等因素
如果想看流量最好的话，有一个策略叫实时测量 -- 核心就是CDN像周围全世界所有的LocalDNS发探测分组来查看相应时间，但是可能许多LocalDNS因为安全问题，配置为不相应探测





