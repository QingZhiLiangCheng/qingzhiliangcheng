---
{"created":"2025-09-12T20:38","updated":"2025-12-26T11:21","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/1.3 网络核心/","dgPassFrontmatter":true,"noteIcon":""}
---

### Overview
> 【对应原书1.3 The Network Core中 1.3.1 Packet Switching 和 1.3.2 Circuit Switching的部分 2025.12.25 - 读原书】

什么是网络核心？ 组成？ : 交换节点和交换节点以及链路构成的中间的网络的核心的那一部分

>[!quote]
> 原书是这么说的：
> netwrok core - the mesh of packet switches and links that interconnets the Internet's end system
> // 【2025.12.25 读原书 补】


功能也很简单，就是传送
问题是，怎么样实现这个最核心的功能
数据交换主要有两种方式
- circuit switch(电路交换): 为每个呼叫预留一条 专有电路
- packet switch(分组交换): 分组为单位，存储转发的方式

### 电路交换
> **//** 主要对应原书部分的1.3.2 Circuit Switching，注意原书先讲的Packet Switching 【2025.12.25 读原书 补】

两个节点之间要通信，首先要通过信令系统，在网络核心当中为两者建立通信分配一条独享的线路

> [!Note]
> 这里原书用了一个很好的词叫 reserved 有预定的意思，并且原书强调 packet switching are not reserved. 书中这里举了一个很形象的例子，就是circuit switching就像需要reservation(预定预约)的餐厅，需要提前预约（我觉得是类比了建立连接），就可以到了直接就餐，并且有保障；而packet switching就像没有reservation的餐厅，到达之后需要排队等待（类比了packet switching中的等待队列）【2025.12.25 读原书 补】

节点与节点之间的链路比较粗，带宽大，可以分成一个一个小片(pieces)，可以采用时分多路复用, 频分多路复用等一系列方法 ; **主机与主机之间可以在众多小片中选择一个空闲的小片**，构成一个独享的电路, 比如图中先选了第二个又选了第一个
![Pasted image 20250917195246.png|300](/img/user/accessory/Pasted%20image%2020250917195246.png)
独享意味着没人有抢，分配了多少带宽就是多少带宽，性能有保障
但是如果线路建立起来了，没有通信，资源会被浪费掉
会有线路建立的事件
并不是换互联网的通信
采用什么方式分成片？
- 频分(Frequency-division multiplexing, FDM)
- 时分(Time-division multiplexing, TDM)
- 波分(Wave-division multiplexing, WDM)
- 码分

![Pasted image 20250917201151.png|400](/img/user/accessory/Pasted%20image%2020250917201151.png)
![Pasted image 20251225134629.png|500](/img/user/accessory/Pasted%20image%2020251225134629.png)
FDM是把两个节点之间的频率划分成一个一个小片，可以选择任意一个空闲的频段
> [!quote]
> 原书: the link dedicates a frequency band to each connection for the duration of the connection.
> // 【2025.12.25 读原书 补】

TDM是将两个节点之间的通信能力分解成一个个以T为单位的周期，在每个T中分成若干个小片，第一个用户用第一个片，第二个用户用第二个片...
> [!quote]
> 原书：time is divided into frames of fixed duration, and each frame is divided into a fixed number of time slots.
> // 【2025.12.25 读原书 补】

> [!quote]
> 原书：For TDM, the transmission rate of a circuit is equal to the frame rate multiplied by the number of bits in a slot.
> // 【2025.12.25 读原书 补】
> 例如，若链路每秒传输8,000帧，且每个时隙为8比特，则每条电路的传输速率为64 kbps。


WDM是将两个节点间的波段分成一个一个小波段

![Pasted image 20250917201710.png|500](/img/user/accessory/Pasted%20image%2020250917201710.png)
![Pasted image 20250917202935.png|300](/img/user/accessory/Pasted%20image%2020250917202935.png)
之所以除以24是因为采用的TDM，用户只使用了带宽的二十四分之一，在轮到你的那个极短的时间片里，你的8个比特数据是以1.536 Mbps的速率被“发射”到线路上的。从这个“瞬时”角度看，你确实用了所有带宽，但是你必须等待其他23个用户也发射完他们的数据后，才能再次发射你的下一组8个比特，因此，从一个更长的时间尺度（比如1秒）来看需要除以24
10.5s只是A发完，最后一个bit还需要传播的时间，这个叫 传播时延，局域网可以忽略，广域网不可以
![Pasted image 20250917203623.png|300](/img/user/accessory/Pasted%20image%2020250917203623.png)
其实这里每个bit都需要传输时间，但是我们算的是整个的事件，所以只用看最后一个出来的bit，也就是A发送完所有的比特(10.5s)的时间 加上传播时延
64kbps是指，每秒钟传输64k个bit，那么传送一个bit需要$\frac{1}{64kbps}$,也就是说传送一个bit并不是顺发，而是有一小段时间，所以第二个bit已经路上走了一段时间了，走的路程是$\frac{1}{64kbps}\times30万公里/s$ ; 当然真正的电磁波在有形的介质中传播，30万公里/s是要打折的

> [!quote]
> 另外，书中说: Note that the transmission time is independent of the number of links. 
> -- 传输时间与链路数量无关：这里注意传输时延是发送时延，不是传播时延
> // 【2025.12.25 读原书 补】

电路交换不适合计算机之间通信
- 连接建立时间比较长
- 计算机之间的通信具有突发性，但是如果想通信就又得建立起连接，而电路交换的链路是独享的，突发性意味着大部分时间是空的， 浪费情况多
- 可靠性不好？，交换机要维持很多对主机之间通信的关系，不同piece之间的映射关系，通常是10万以上的关系的维护，如果一旦宕机，影响主机对之间的通信的范围广

### 分组交换
> [!note]
>  主要对应原书部分的1.3.1 Packet Switching，注意原书先讲的Packet Switching 【2025.12.25 读原书 补】
>  Packet Switching 的核心问题就像书中给的小标题一样，在于 Store-and-Forward Transmision(存储转发)， Queuing Delays and Packet Loss(排队延时和丢包现象)以及Forwarding Tables and Routing Protocols (转发表和路由)【2025.12.25 读原书 补】

核心不在分为一个一个片，要用全用，要用就用1.536Mbps的宽带，而不只是其中的二十四分之一
主机和主机之间通信的数据就分成一个个单位，这个单位叫分组(packet)
每个节点先存储再转发, 分组每次移动一跳(hop)
为什么要先存下整个packet再转发？
如果不存储转发前面先发送的bit就跑到下一段链路上去了，下一段链路就没法被别的通信用了，时间换并发
在线路交换过程中，在每个节点中耽误发送一个bit的时间；但在分组交换中，每个节点要耽误存储整个分组的时间

> [!note]
> 存储转发这里原书写的很好，只针对存储转发的时间讲了一个例子，并且很详细的分析了整个过程，并给出了一般的公式
> ![Pasted image 20251225142201.png|400](/img/user/accessory/Pasted%20image%2020251225142201.png)
> 这里假设没有propagation delay，即传播时延，假设每个packet长为L bits，链路传播速率为R bps，那也就是说，从0开始经过$\frac{L}{R}$时间，整个第一个packet完全被source打出，由于忽略了传播时延，所以这个时间点也是整个第一个packet到达router的时间
> $\frac{2L}{R}$时间source完全打出整个packet2，整个packet2到达路由器，路由器完全打出了整个packet1，整个packet1完全达到Destination
> $\frac{3L}{R}$时间source完全打出整个packet3，整个packet3到达路由器，路由器完全打出了整个packet2，整个packet2完全达到Destination
> $\frac{4L}{R}$时间，路由器完全打出了整个packet3，整个packet3完全达到Destination
> 原书中给出了N段链路(中间N-1个路由器)，聚焦于一个packet完整的从source到destination的时间公式
> ![Pasted image 20251225143015.png|500](/img/user/accessory/Pasted%20image%2020251225143015.png)
> 并要求尝试推导P个packet从source到destination整个时间
> 最终答案应该是：
> $$
> =\frac{(N+P-1)L}{R}
> $$
> 这是由于存储–转发机制和流水线效应的存在。第一个分组需要依次在所有 N 条链路上传输，因此其到达目的节点所需的时间为 $\frac{NL}{R}$​。当第一个分组到达最后一个节点时，第二个分组已经完成了前 N−1 条链路的传输并到达倒数第二个节点。此时，第二个分组仍需在最后一条链路上进行一次传输，其传输时延为 $\frac{L}{R}$​。在这段时间内，第三个分组到达倒数第二个节点。依此类推，由于流水线传输，每增加一个分组，目的节点接收到分组的时间仅增加一个 $\frac{L}{R}$此类推... 总共P-1个
> // 【2025.12.25 读原书 补】

example
![Pasted image 20250917212239.png|400](/img/user/accessory/Pasted%20image%2020250917212239.png)
注意发和接是一个事情的两个方面，我们只用选取一个方面算一次
![Pasted image 20250917212502.png|300](/img/user/accessory/Pasted%20image%2020250917212502.png)
发10s，接10s 不能弄在一起算，在上面这个图中其实都是10s+传播时延，只不过一个算的是接收时间+第一个比特的传输时延，一个算的是发送时间+最后一个比特的传输时延；而且如果A和B贴着脸哈哈哈，实际上发和接就是一个时段
![Pasted image 20250917213103.png|300](/img/user/accessory/Pasted%20image%2020250917213103.png)
红线是发 蓝线是收
当一个节点接受到一个分组，存储下来，通过查找转发表决定往某个方向传，但是很不幸，如果这个方向已经有分组再传了，甚至有好多个分组再等待，那就要排队，这里就会有一个排队时延

> [!note]
> ![Pasted image 20251225143858.png|400](/img/user/accessory/Pasted%20image%2020251225143858.png)
> // 【2025.12.25 读原书 补 图】

![Pasted image 20250917213205.png|400](/img/user/accessory/Pasted%20image%2020250917213205.png)
如果到达速率>链路的输出速率，那就会在队列中聚积，如果路由器的缓存用完了，分组就会抛弃，俗称丢包
分组交换的好处在于获得网络的共享性，反过来来说，同样的网络资源，在网络计算机具备很强的突发性的情况下，分组交换相比线路交换支持的主机的数量多一些，但是，存储时间，不可预计的排队延迟，以及可能得丢弃都是分组交换为了获取共享性所必须付出的代价
像ip网这样的分组交换网络而言，网络的核心最主要有两个作用
- 转发
- 路由

![Pasted image 20250917215555.png|300](/img/user/accessory/Pasted%20image%2020250917215555.png)
转发: 查路由表决定往哪个链路或者说哪个方向发送，是局部的
路由表是哪里来的？是由运行着的路由模块跟其他路由器交换路由信息，算出来的 -- 这是一个全局的

> [!quote]
> 原书: How do forwarding tables get set? Are they configured by hand in each and every router, or does the Internet use a more automated procedure? ...(省略) studied in depth in Chapter 5. ...(省略) A routing protocol may, for example, determine the shortest path from each router to each router to each destination and use the shortest path results to configure the forwarding tablets in the routers.
> // 【2025.12.25 读原书 补】


![Pasted image 20250917220113.png|400](/img/user/accessory/Pasted%20image%2020250917220113.png)
分组交换像是一个时间复用，比如图上的第一段时间是A用，然后是B用，然后A用，A用，但是注意会有空闲的事件
他有点像TDM, 但是TDM划分时间片的那种方式是固定的，换句话说，A用完了只能等下一个周期的时间片才能用，而分组交换没有周期，是谁来谁用
分组交换的这个方式叫做统计多路复用

定性证明: 同样的网络资源，分组交换允许更多用户使用网络
![Pasted image 20250917222455.png|200](/img/user/accessory/Pasted%20image%2020250917222455.png)
N个用户，链路带宽为1MB/s，每个用户有10%的可能性活动，活跃时的带宽是100ks/s
那么电路交换最多就只能容纳$\frac{1Mb/s}{100kb/s}=10$个用户
分组交换麻烦一点，假设有35个用户，每个用户有10%的概率活跃，那么有n个用户活动的概率是
$$
\begin{bmatrix}35\\n\end{bmatrix}p^n(1-p)^{35-n}
$$
那么如果有大于等于10个用户活动的概率就是
$$
1-\sum^{10}_{n=0}\begin{bmatrix}35\\n\end{bmatrix}p^n(1-p)^{35-n}=0.0004
$$
为什么是10，因为每个用户活活跃时的带宽是100ks/s
这说明如果有35个用户其中10个活跃 也能运行的很好
但是ppt中写的是9，而不是10，有一个概念叫流量强度，流量强度=1的时候就挂了
当然这里有0.04%的时候会hold不住，但是他有一个补丁 -- 队列

如果把35换成35000，那实际上10个人一起用的概率是很大的，所以说不能滥用，过度的用分组交换
实际上，网络核心和主机之间还有机制来防止这种情况

有时候我们在分组交换上想然他有线路交换的表现，因为有些应用需要线路交换的这种方式，比如流媒体服务器和流媒体客户端(点播，机顶盒...) 后面会讲

分组交换按照网络有没有连接分成两种方式
**数据报网络**: 原主机发给目标主机的分组，携带了目标主机的完整地址，交换节点根据完整地址存储转发，两个主机在通信之前不需要握手，每个分组之间的传播都是独立的，交换节点不用维护通信状态，像写信
![Pasted image 20250917224910.png|400](/img/user/accessory/Pasted%20image%2020250917224910.png)
可能走不同路径
**虚电路网络**: 像打电话一样，通信之前握个手，握手是为了在交换节点之间保持状态，建立起一条虚拟线路，每个分组携带虚电路号，在分组中存储转发
![Pasted image 20250917224926.png|500](/img/user/accessory/Pasted%20image%2020250917224926.png)
虚电路靠新信令建立

