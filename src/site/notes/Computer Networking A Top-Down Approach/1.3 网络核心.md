---
{"created":"2025-09-12T20:38","updated":"2025-09-17T22:58","dg-publish":true,"permalink":"/Computer Networking A Top-Down Approach/1.3 网络核心/","dgPassFrontmatter":true,"noteIcon":""}
---

组成: 交换节点和交换节点以及链路构成的中间的网络的核心的那一部分
功能也很简单，就是传送
问题是，怎么样实现这个最核心的功能
数据交换主要有两种方式
- circuit switch(电路交换): 为每个呼叫预留一条 专有电路
- packet switch(分组交换): 分组为单位，存储转发的方式

### 电路交换
两个节点之间要通信，首先要通过信令系统，在网络核心当中为两者建立通信分配一条独享的线路
节点与节点之间的链路比较粗，带宽大，可以分成一个一个小片(pieces)，可以采用时分多路复用, 频分多路复用等一系列方法 ; 主机与主机之间可以在众多小片中选择一个空闲的小片，构成一个独享的电路
![Pasted image 20250917195246.png|300](/img/user/accessory/Pasted%20image%2020250917195246.png)
独享意味着没人有抢，分配了多少带宽就是多少带宽，性能有保障
但是如果线路建立起来了，没有通信，资源会被浪费掉
会有线路建立的事件
并不是换互联网的通信
采用什么方式分成片？
- 频分(Frequency-division multiplexing, FDM)
- 时分(Time-division multiplexing, TDM)
- 波分(Wave-division multiplexing, WDM)
- 码分

![Pasted image 20250917201151.png|400](/img/user/accessory/Pasted%20image%2020250917201151.png)
FDM是把两个节点之间的频率划分成一个一个小片，可以选择任意一个空闲的频段
TDM是将两个节点之间的通信能力分解成一个个以T为单位的周期，在每个T中分成若干个小片，第一个用户用第一个片，第二个用户用第二个片...
WDM是将两个节点间的波段分成一个一个小波段
![Pasted image 20250917201710.png|500](/img/user/accessory/Pasted%20image%2020250917201710.png)
![Pasted image 20250917202935.png|300](/img/user/accessory/Pasted%20image%2020250917202935.png)
之所以除以24是因为采用的TDM，用户只使用了带宽的二十四分之一，在轮到你的那个极短的时间片里，你的8个比特数据是以1.536 Mbps的速率被“发射”到线路上的。从这个“瞬时”角度看，你确实用了所有带宽，但是你必须等待其他23个用户也发射完他们的数据后，才能再次发射你的下一组8个比特，因此，从一个更长的时间尺度（比如1秒）来看需要除以24
10.5s只是A发完，最后一个bit还需要传播的时间，这个叫 传播时延，局域网可以忽略，广域网不可以
![Pasted image 20250917203623.png|300](/img/user/accessory/Pasted%20image%2020250917203623.png)
其实这里每个bit都需要传输时间，但是我们算的是整个的事件，所以只用看最后一个出来的bit，也就是A发送完所有的比特(10.5s)的时间 加上传播时延
64kbps是指，每秒钟传输64k个bit，那么传送一个bit需要$\frac{1}{64kbps}$,也就是说传送一个bit并不是顺发，而是有一小段时间，所以第二个bit已经路上走了一段时间了，走的路程是$\frac{1}{64kbps}\times30万公里/s$ ; 当然真正的电磁波在有形的介质中传播，30万公里/s是要打折的

电路交换不适合计算机之间通信
- 连接建立时间比较长
- 计算机之间的通信具有突发性，但是如果想通信就又得建立起连接，而电路交换的链路是独享的，突发性意味着大部分时间是空的， 浪费情况多
- 可靠性不好？，交换机要维持很多对主机之间通信的关系，不同piece之间的映射关系，通常是10万以上的关系的维护，如果一旦宕机，影响主机对之间的通信的范围广

### 分组交换
不在分为一个一个片，要用全用，要用就用1.536Mbps的宽带，而不只是其中的二十四分之一
主机和主机之间通信的数据就分成一个个单位，这个单位叫分组(packet)
每个节点先存储再转发, 分组每次移动一跳(hop)
为什么要先存下整个packet再转发？
如果不存储转发前面先发送的bit就跑到下一段链路上去了，下一段链路就没法被别的通信用了，时间换并发

在线路交换过程中，在每个节点中耽误发送一个bit的时间；但在分组交换中，每个节点要耽误存储整个分组的时间
当一个节点接受到一个分组，存储下来，通过查找转发表决定往某个方向传，但是很不幸，如果这个方向已经有分组再传了，甚至有好多个分组再等待，那就要排队，这里就会有一个排队时延
example
![Pasted image 20250917212239.png|400](/img/user/accessory/Pasted%20image%2020250917212239.png)
注意发和接是一个事情的两个方面，我们只用选取一个方面算一次
![Pasted image 20250917212502.png|300](/img/user/accessory/Pasted%20image%2020250917212502.png)
发10s，接10s 不能弄在一起算，在上面这个图中其实都是10s+传播时延，只不过一个算的是接收时间+第一个比特的传输时延，一个算的是发送时间+最后一个比特的传输时延；而且如果A和B贴着脸哈哈哈，实际上发和接就是一个时段
![Pasted image 20250917213103.png|300](/img/user/accessory/Pasted%20image%2020250917213103.png)
红线是发 蓝线是收
![Pasted image 20250917213205.png|400](/img/user/accessory/Pasted%20image%2020250917213205.png)
如果到达速率>链路的输出速率，那就会在队列中聚积，如果路由器的缓存用完了，分组就会抛弃，俗称丢包

分组交换的好处在于获得网络的共享性，反过来来说，同样的网络资源，在网络计算机具备很强的突发性的情况下，分组交换相比线路交换支持的主机的数量多一些，但是，存储时间，不可预计的排队延迟，以及可能得丢弃都是分组交换为了获取共享性所必须付出的代价
像ip王这样的分组交换网络而言，网络的核心最主要有两个作用
- 转发
- 路由

![Pasted image 20250917215555.png|300](/img/user/accessory/Pasted%20image%2020250917215555.png)
转发: 查路由表决定往哪个链路或者说哪个方向发送，是局部的
路由表是哪里来的？是由运行着的路由模块跟其他路由器交换路由信息，算出来的 -- 这是一个全局的
![Pasted image 20250917220113.png|400](/img/user/accessory/Pasted%20image%2020250917220113.png)
分组交换像是一个时间复用，比如图上的第一段时间是A用，然后是B用，然后A用，A用，但是注意会有空闲的事件
他有点像TDM, 但是TDM划分时间片的那种方式是固定的，换句话说，A用完了只能等下一个周期的时间片才能用，而分组交换没有周期，是谁来谁用
分组交换的这个方式叫做统计多路复用

定性证明: 同样的网络资源，分组交换允许更多用户使用网络
![Pasted image 20250917222455.png|200](/img/user/accessory/Pasted%20image%2020250917222455.png)
N个用户，链路带宽为1MB/s，每个用户有10%的可能性活动，活跃时的带宽是100ks/s
那么电路交换最多就只能容纳$\frac{1Mb/s}{100kb/s}=10$个用户
分组交换麻烦一点，假设有35个用户，每个用户有10%的概率活跃，那么有n个用户活动的概率是
$$
\begin{bmatrix}35\\n\end{bmatrix}p^n(1-p)^{35-n}
$$
那么如果有大于等于10个用户活动的概率就是
$$
1-\sum^{10}_{n=0}\begin{bmatrix}35\\n\end{bmatrix}p^n(1-p)^{35-n}=0.0004
$$
为什么是10，因为每个用户活活跃时的带宽是100ks/s
这说明如果有35个用户其中10个活跃 也能运行的很好
但是ppt中写的是9，而不是10，有一个概念叫流量强度，流量强度=1的时候就挂了
当然这里有0.04%的时候会hold不住，但是他有一个补丁 -- 队列

如果把35换成35000，那实际上10个人一起用的概率是很大的，所以说不能滥用，过度的用分组交换
实际上，网络核心和主机之间还有机制来防止这种情况

有时候我们在分组交换上想然他有线路交换的表现，因为有些应用需要线路交换的这种方式，比如流媒体服务器和流媒体客户端(点播，机顶盒...) 后面会讲

分组交换按照网络有没有连接分成两种方式
**数据报网络**: 原主机发给目标主机的分组，携带了目标主机的完整地址，交换节点根据完整地址存储转发，两个主机在通信之前不需要握手，每个分组之间的传播都是独立的，交换节点不用维护通信状态，像写信
![Pasted image 20250917224910.png|400](/img/user/accessory/Pasted%20image%2020250917224910.png)
可能走不同路径
**虚电路网络**: 像打电话一样，通信之前握个手，握手是为了在交换节点之间保持状态，建立起一条虚拟线路，每个分组携带虚电路号，在分组中存储转发
![Pasted image 20250917224926.png|500](/img/user/accessory/Pasted%20image%2020250917224926.png)
虚电路靠新信令建立

